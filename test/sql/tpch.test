# name: test/sql/tpch.test
# description: TPC-H correctness suite for lance_scan
# group: [sql]

require lance

statement ok
CREATE OR REPLACE VIEW customer AS SELECT * FROM 'test/tpch_sf0_01/customer.lance';

statement ok
CREATE OR REPLACE VIEW lineitem AS SELECT * FROM 'test/tpch_sf0_01/lineitem.lance';

statement ok
CREATE OR REPLACE VIEW nation AS SELECT * FROM 'test/tpch_sf0_01/nation.lance';

statement ok
CREATE OR REPLACE VIEW orders AS SELECT * FROM 'test/tpch_sf0_01/orders.lance';

statement ok
CREATE OR REPLACE VIEW part AS SELECT * FROM 'test/tpch_sf0_01/part.lance';

statement ok
CREATE OR REPLACE VIEW partsupp AS SELECT * FROM 'test/tpch_sf0_01/partsupp.lance';

statement ok
CREATE OR REPLACE VIEW region AS SELECT * FROM 'test/tpch_sf0_01/region.lance';

statement ok
CREATE OR REPLACE VIEW supplier AS SELECT * FROM 'test/tpch_sf0_01/supplier.lance';

# Q1
query TTRRRRRRRI
SELECT
    l_returnflag,
    l_linestatus,
    sum(l_quantity) AS sum_qty,
    sum(l_extendedprice) AS sum_base_price,
    sum(l_extendedprice * (1 - l_discount)) AS sum_disc_price,
    sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) AS sum_charge,
    avg(l_quantity) AS avg_qty,
    avg(l_extendedprice) AS avg_price,
    avg(l_discount) AS avg_disc,
    count(*) AS count_order
FROM
    lineitem
WHERE
    l_shipdate <= CAST('1998-09-02' AS date)
GROUP BY
    l_returnflag,
    l_linestatus
ORDER BY
    l_returnflag,
    l_linestatus
----
A	F	380456.00	532348211.65	505822441.4861	526165934.000839	25.575154611454693	35785.70930693735	0.05008133906964238	14876
N	F	8971.00	12384801.37	11798257.2080	12282485.056933	25.778735632183906	35588.50968390804	0.047758620689655175	348
N	O	742802.00	1041502841.45	989737518.6346	1029418531.523350	25.45498783454988	35691.129209074395	0.04993111956409993	29181
R	F	381449.00	534594445.35	507996454.4067	528524219.358903	25.597168165346933	35874.00653268018	0.049827539927526504	14902

# Q2
query RTTITTTT
SELECT
    s_acctbal,
    s_name,
    n_name,
    p_partkey,
    p_mfgr,
    s_address,
    s_phone,
    s_comment
FROM
    part,
    supplier,
    partsupp,
    nation,
    region
WHERE
    p_partkey = ps_partkey
    AND s_suppkey = ps_suppkey
    AND p_size = 15
    AND p_type LIKE '%BRASS'
    AND s_nationkey = n_nationkey
    AND n_regionkey = r_regionkey
    AND r_name = 'EUROPE'
    AND ps_supplycost = (
        SELECT
            min(ps_supplycost)
        FROM
            partsupp,
            supplier,
            nation,
            region
        WHERE
            p_partkey = ps_partkey
            AND s_suppkey = ps_suppkey
            AND s_nationkey = n_nationkey
            AND n_regionkey = r_regionkey
            AND r_name = 'EUROPE')
ORDER BY
    s_acctbal DESC,
    n_name,
    s_name,
    p_partkey
LIMIT 100
----
4186.95	Supplier#000000077	GERMANY	249	Manufacturer#4	w5yO 0yjXou 8I4ffzADq,R8tD06x1vbeMpLJF2	17-281-345-4863	ainst the blithely ironic packages poach at the regul
1883.37	Supplier#000000086	ROMANIA	1015	Manufacturer#4	iZLKKWaQADe	29-903-665-7065	 foxes boost after the carefully silent asymptotes. slyl
1687.81	Supplier#000000017	ROMANIA	1634	Manufacturer#2	PYN0m9j98GhX42DvBKvURcAd,B	29-601-884-9219	se slyly furiously even notornis. furiously regular packa
287.16	Supplier#000000052	ROMANIA	323	Manufacturer#4	5oGr3pj2sprZNwho8CFW2haaObd0	29-974-934-4713	arefully silent pinto beans use furiously furiously even deposits. regular packages are furious

# Q3
query IRTI
SELECT
    l_orderkey,
    sum(l_extendedprice * (1 - l_discount)) AS revenue,
    o_orderdate,
    o_shippriority
FROM
    customer,
    orders,
    lineitem
WHERE
    c_mktsegment = 'BUILDING'
    AND c_custkey = o_custkey
    AND l_orderkey = o_orderkey
    AND o_orderdate < CAST('1995-03-15' AS date)
    AND l_shipdate > CAST('1995-03-15' AS date)
GROUP BY
    l_orderkey,
    o_orderdate,
    o_shippriority
ORDER BY
    revenue DESC,
    o_orderdate
LIMIT 10
----
47714	267010.5894	1995-03-11	0
22276	266351.5562	1995-01-29	0
32965	263768.3414	1995-02-25	0
21956	254541.1285	1995-02-02	0
1637	243512.7981	1995-02-08	0
10916	241320.0814	1995-03-11	0
30497	208566.6969	1995-02-07	0
450	205447.4232	1995-03-05	0
47204	204478.5213	1995-03-13	0
9696	201502.2188	1995-02-20	0

# Q4
query TI
SELECT
    o_orderpriority,
    count(*) AS order_count
FROM
    orders
WHERE
    o_orderdate >= CAST('1993-07-01' AS date)
    AND o_orderdate < CAST('1993-10-01' AS date)
    AND EXISTS (
        SELECT
            *
        FROM
            lineitem
        WHERE
            l_orderkey = o_orderkey
            AND l_commitdate < l_receiptdate)
GROUP BY
    o_orderpriority
ORDER BY
    o_orderpriority
----
1-URGENT	93
2-HIGH	103
3-MEDIUM	109
4-NOT SPECIFIED	102
5-LOW	128

# Q5
query TR
SELECT
    n_name,
    sum(l_extendedprice * (1 - l_discount)) AS revenue
FROM
    customer,
    orders,
    lineitem,
    supplier,
    nation,
    region
WHERE
    c_custkey = o_custkey
    AND l_orderkey = o_orderkey
    AND l_suppkey = s_suppkey
    AND c_nationkey = s_nationkey
    AND s_nationkey = n_nationkey
    AND n_regionkey = r_regionkey
    AND r_name = 'ASIA'
    AND o_orderdate >= CAST('1994-01-01' AS date)
    AND o_orderdate < CAST('1995-01-01' AS date)
GROUP BY
    n_name
ORDER BY
    revenue DESC
----
VIETNAM	1000926.6999
CHINA	740210.7570
JAPAN	660651.2425
INDONESIA	566379.5276
INDIA	422874.6844

# Q6
query R
SELECT
    sum(l_extendedprice * l_discount) AS revenue
FROM
    lineitem
WHERE
    l_shipdate >= CAST('1994-01-01' AS date)
    AND l_shipdate < CAST('1995-01-01' AS date)
    AND l_discount BETWEEN 0.05
    AND 0.07
    AND l_quantity < 24
----
1193053.2253

# Q7
query TTIR
SELECT
    supp_nation,
    cust_nation,
    l_year,
    sum(volume) AS revenue
FROM (
    SELECT
        n1.n_name AS supp_nation,
        n2.n_name AS cust_nation,
        extract(year FROM l_shipdate) AS l_year,
        l_extendedprice * (1 - l_discount) AS volume
    FROM
        supplier,
        lineitem,
        orders,
        customer,
        nation n1,
        nation n2
    WHERE
        s_suppkey = l_suppkey
        AND o_orderkey = l_orderkey
        AND c_custkey = o_custkey
        AND s_nationkey = n1.n_nationkey
        AND c_nationkey = n2.n_nationkey
        AND ((n1.n_name = 'FRANCE'
                AND n2.n_name = 'GERMANY')
            OR (n1.n_name = 'GERMANY'
                AND n2.n_name = 'FRANCE'))
        AND l_shipdate BETWEEN CAST('1995-01-01' AS date)
        AND CAST('1996-12-31' AS date)) AS shipping
GROUP BY
    supp_nation,
    cust_nation,
    l_year
ORDER BY
    supp_nation,
    cust_nation,
    l_year
----
FRANCE	GERMANY	1995	268068.5774
FRANCE	GERMANY	1996	303862.2980
GERMANY	FRANCE	1995	621159.4882
GERMANY	FRANCE	1996	379095.8854

# Q8
query IR
SELECT
    o_year,
    sum(
        CASE WHEN nation = 'BRAZIL' THEN
            volume
        ELSE
            0
        END) / sum(volume) AS mkt_share
FROM (
    SELECT
        extract(year FROM o_orderdate) AS o_year,
        l_extendedprice * (1 - l_discount) AS volume,
        n2.n_name AS nation
    FROM
        part,
        supplier,
        lineitem,
        orders,
        customer,
        nation n1,
        nation n2,
        region
    WHERE
        p_partkey = l_partkey
        AND s_suppkey = l_suppkey
        AND l_orderkey = o_orderkey
        AND o_custkey = c_custkey
        AND c_nationkey = n1.n_nationkey
        AND n1.n_regionkey = r_regionkey
        AND r_name = 'AMERICA'
        AND s_nationkey = n2.n_nationkey
        AND o_orderdate BETWEEN CAST('1995-01-01' AS date)
        AND CAST('1996-12-31' AS date)
        AND p_type = 'ECONOMY ANODIZED STEEL') AS all_nations
GROUP BY
    o_year
ORDER BY
    o_year
----
1995	0.0
1996	0.0

# Q9
query TIR
SELECT
    nation,
    o_year,
    sum(amount) AS sum_profit
FROM (
    SELECT
        n_name AS nation,
        extract(year FROM o_orderdate) AS o_year,
        l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity AS amount
    FROM
        part,
        supplier,
        lineitem,
        partsupp,
        orders,
        nation
    WHERE
        s_suppkey = l_suppkey
        AND ps_suppkey = l_suppkey
        AND ps_partkey = l_partkey
        AND p_partkey = l_partkey
        AND o_orderkey = l_orderkey
        AND s_nationkey = n_nationkey
        AND p_name LIKE '%green%') AS profit
GROUP BY
    nation,
    o_year
ORDER BY
    nation,
    o_year DESC
----
ALGERIA	1998	97864.5682
ALGERIA	1997	368231.6695
ALGERIA	1996	196525.8046
ALGERIA	1995	341438.6885
ALGERIA	1994	677444.0160
ALGERIA	1993	458756.9157
ALGERIA	1992	549243.9511
ARGENTINA	1998	80448.7680
ARGENTINA	1997	186279.1618
ARGENTINA	1996	154041.8822
ARGENTINA	1995	113143.3119
ARGENTINA	1994	169680.4239
ARGENTINA	1993	116513.8141
ARGENTINA	1992	202404.7608
BRAZIL	1998	75952.5946
BRAZIL	1997	190548.1104
BRAZIL	1996	219059.0692
BRAZIL	1995	186435.2023
BRAZIL	1994	96835.1870
BRAZIL	1993	186365.4109
BRAZIL	1992	152546.4439
CANADA	1998	101030.3336
CANADA	1997	101197.3441
CANADA	1996	257697.1355
CANADA	1995	91474.8820
CANADA	1994	249182.7548
CANADA	1993	185737.8379
CANADA	1992	143371.7465
CHINA	1998	508364.5444
CHINA	1997	650235.1646
CHINA	1996	911366.0698
CHINA	1995	797268.4076
CHINA	1994	529989.3095
CHINA	1993	573864.3972
CHINA	1992	751688.7613
EGYPT	1998	306325.2842
EGYPT	1997	568461.6699
EGYPT	1996	465081.9232
EGYPT	1995	542886.5087
EGYPT	1994	745807.8123
EGYPT	1993	381503.2008
EGYPT	1992	641866.4367
ETHIOPIA	1998	226054.5716
ETHIOPIA	1997	585193.2802
ETHIOPIA	1996	405412.7741
ETHIOPIA	1995	270455.7637
ETHIOPIA	1994	567875.4279
ETHIOPIA	1993	412302.2871
ETHIOPIA	1992	551284.5821
FRANCE	1998	135723.4050
FRANCE	1997	249664.7578
FRANCE	1996	175882.8934
FRANCE	1995	116394.7866
FRANCE	1994	197695.2438
FRANCE	1993	231878.6201
FRANCE	1992	199131.2037
GERMANY	1998	172741.1024
GERMANY	1997	393833.4660
GERMANY	1996	335634.5936
GERMANY	1995	378106.0763
GERMANY	1994	250107.6653
GERMANY	1993	327154.9365
GERMANY	1992	387240.0885
INDIA	1998	347548.7604
INDIA	1997	656797.9670
INDIA	1996	522759.3529
INDIA	1995	574428.6693
INDIA	1994	741983.7846
INDIA	1993	729948.5341
INDIA	1992	661061.1415
INDONESIA	1998	91791.5096
INDONESIA	1997	183956.4613
INDONESIA	1996	415234.7848
INDONESIA	1995	427155.3804
INDONESIA	1994	286271.2875
INDONESIA	1993	551178.8823
INDONESIA	1992	274513.2685
IRAN	1998	47959.8219
IRAN	1997	184335.0615
IRAN	1996	223115.2464
IRAN	1995	125339.0927
IRAN	1994	117228.3122
IRAN	1993	208030.3229
IRAN	1992	161835.5475
IRAQ	1998	161797.4924
IRAQ	1997	224876.5436
IRAQ	1996	145277.8980
IRAQ	1995	467955.2505
IRAQ	1994	97455.2990
IRAQ	1993	114821.6440
IRAQ	1992	213307.1574
JAPAN	1998	307594.5980
JAPAN	1997	339018.1488
JAPAN	1996	649578.3368
JAPAN	1995	671644.0911
JAPAN	1994	576266.2386
JAPAN	1993	514190.8437
JAPAN	1992	534914.9339
JORDAN	1996	33460.2447
JORDAN	1995	20364.1623
JORDAN	1994	15528.6088
JORDAN	1993	14640.9889
JORDAN	1992	10904.2931
KENYA	1998	521926.5198
KENYA	1997	559632.3408
KENYA	1996	772855.7939
KENYA	1995	516452.5067
KENYA	1994	543665.8154
KENYA	1993	866924.8754
KENYA	1992	567410.5502
MOROCCO	1998	217794.4973
MOROCCO	1997	439240.9287
MOROCCO	1996	399969.4680
MOROCCO	1995	258131.9398
MOROCCO	1994	386972.1424
MOROCCO	1993	145468.0381
MOROCCO	1992	284314.2813
MOZAMBIQUE	1998	518693.2238
MOZAMBIQUE	1997	613873.2961
MOZAMBIQUE	1996	936793.5612
MOZAMBIQUE	1995	727204.7718
MOZAMBIQUE	1994	1104618.1807
MOZAMBIQUE	1993	893266.0530
MOZAMBIQUE	1992	1062432.0884
PERU	1998	287242.9797
PERU	1997	532358.3660
PERU	1996	398435.7507
PERU	1995	462031.6251
PERU	1994	304235.4118
PERU	1993	505885.4890
PERU	1992	382290.0947
ROMANIA	1998	357824.5528
ROMANIA	1997	569806.5564
ROMANIA	1996	732001.5568
ROMANIA	1995	408657.1154
ROMANIA	1994	540702.5463
ROMANIA	1993	883158.5056
ROMANIA	1992	505488.9501
RUSSIA	1998	34448.6357
RUSSIA	1997	314972.0446
RUSSIA	1996	430049.5821
RUSSIA	1995	360538.0586
RUSSIA	1994	301791.0114
RUSSIA	1993	308993.9622
RUSSIA	1992	289868.6564
SAUDI ARABIA	1998	16502.4100
SAUDI ARABIA	1997	61830.9556
SAUDI ARABIA	1996	213650.2809
SAUDI ARABIA	1995	62668.7250
SAUDI ARABIA	1994	94629.1538
SAUDI ARABIA	1993	57768.3071
SAUDI ARABIA	1992	66520.1093
UNITED KINGDOM	1998	80437.6523
UNITED KINGDOM	1997	252509.7351
UNITED KINGDOM	1996	231152.8582
UNITED KINGDOM	1995	181310.8808
UNITED KINGDOM	1994	239161.2061
UNITED KINGDOM	1993	122103.1142
UNITED KINGDOM	1992	60882.3080
UNITED STATES	1998	440347.6658
UNITED STATES	1997	652958.9371
UNITED STATES	1996	1004593.8282
UNITED STATES	1995	860144.1029
UNITED STATES	1994	807797.4877
UNITED STATES	1993	736669.4711
UNITED STATES	1992	877851.4103
VIETNAM	1998	358248.0159
VIETNAM	1997	394817.2842
VIETNAM	1996	439390.0836
VIETNAM	1995	418626.6325
VIETNAM	1994	422644.8168
VIETNAM	1993	309063.4020
VIETNAM	1992	716126.5378

# Q10
query ITRRTTTT
SELECT
    c_custkey,
    c_name,
    sum(l_extendedprice * (1 - l_discount)) AS revenue,
    c_acctbal,
    n_name,
    c_address,
    c_phone,
    c_comment
FROM
    customer,
    orders,
    lineitem,
    nation
WHERE
    c_custkey = o_custkey
    AND l_orderkey = o_orderkey
    AND o_orderdate >= CAST('1993-10-01' AS date)
    AND o_orderdate < CAST('1994-01-01' AS date)
    AND l_returnflag = 'R'
    AND c_nationkey = n_nationkey
GROUP BY
    c_custkey,
    c_name,
    c_acctbal,
    c_phone,
    n_name,
    c_address,
    c_comment
ORDER BY
    revenue DESC
LIMIT 20
----
679	Customer#000000679	378211.3252	1394.44	IRAN	jhLZlG1fRiSE0 wDLOCguVB96dH6a5	20-146-696-9508	oys. furiously silent pinto beans
1201	Customer#000001201	374331.5340	5165.39	IRAN	gLo85h4Cst5ckn40ZKR6403KjW26YCWAFZsq d	20-825-400-1187	r foxes boost blithely final accounts. furiously silent ideas unwind. blithely even dependencies wake slyly; sly
422	Customer#000000422	366451.0126	-272.14	INDONESIA	rtds1qwEinDWYhyIbRusRgXBDxGJraP,C,S zDwA	19-299-247-2444	 are carefully. slyly regular requests hag
334	Customer#000000334	360370.7550	-405.91	EGYPT	dbdZdUyWQaZX7DoCO	14-947-291-5002	r, bold pinto beans according to the blithely final theodolites can snooze slyly even packages. carefully ironic acc
805	Customer#000000805	359448.9036	511.69	IRAN	woguVtOjwvC8LLtPRALISNwAOFRf70Pfqk	20-732-989-5653	 quickly unusual accounts haggle carefully after the even accounts. deposits cajole carefully bravely spec
932	Customer#000000932	341608.2753	6553.37	JORDAN	kdRqB0ezhkUePSc	23-300-708-7927	ound the regular accounts. quickly ironic requests try to 
853	Customer#000000853	341236.6246	-444.73	BRAZIL	7,rRbAvqK4hSqm,ljEDolyjRp8Mu44xSTG	12-869-161-3468	l foxes affix. furiously regular foxes
872	Customer#000000872	338328.7808	-858.61	PERU	xfbTIe1pgWq0jqdm7gQP6iXqcs2RcSk	27-357-139-7164	unts believe across the ironic instructions. packages nag re
737	Customer#000000737	338185.3365	2501.74	CHINA	eNHkZHYWXIpf8Ct,F2Aej BwxkZ6LTW	28-658-938-1102	ackages. blithely daring packages detect slyly around the carefully busy excuses. f
1118	Customer#000001118	319875.7280	4130.18	IRAQ	bjK0newm53R2CoNAtvQsIqh	21-583-715-8627	ecial sentiments. express deposits across the blithely express packages wake quickly across the attainments. platele
223	Customer#000000223	319564.2750	7476.20	SAUDI ARABIA	MyQxUcG0P QCetmG00GlF	30-193-643-1517	xcuses. silent theodolites across the carefully bold excuses sleep ironic, final courts. regular excuses
808	Customer#000000808	314774.6167	5561.93	ROMANIA	9Y4G8hokyDQJOlcCUe4OypX smFlME6d Kr	29-531-319-7726	usual pinto beans use carefully. express ideas boost. ironic, ironic Tir
478	Customer#000000478	299651.8026	-210.40	ARGENTINA	PFtAWWSniG43yWAgtjFPN0DrhyMCDIm	11-655-291-2694	even asymptotes haggle carefully slyl
1441	Customer#000001441	294705.3935	9465.15	UNITED KINGDOM	y,221QWUv0CvgCVkRwsrOUpRshWpcjKkrHu	33-681-334-4499	ccounts are furiously above the slyly even foxes. furiously even requests hagg
1478	Customer#000001478	294431.9178	9701.54	GERMANY	vTjnwinnB9YeA1VxKYoQELaZJm,HW	17-420-484-5959	nal instructions. quickly regular excuses haggle after the sl
211	Customer#000000211	287905.6368	4198.72	JORDAN	79JF5cssWlB3ME	23-965-335-9471	unusual requests haggle after the unusual, ironic ideas. ironic orbits hinder carefully quickly final p
197	Customer#000000197	283190.4807	9860.22	ARGENTINA	7M5Az MBdx4Ey1XTn	11-107-312-6585	latelets doze fluffily blithely final dep
1030	Customer#000001030	282557.3566	6359.27	INDIA	4ByZpJpVJRD	18-759-877-1870	 the final accounts. quick platelets are carefully. instructions a
1049	Customer#000001049	281134.1117	8747.99	INDONESIA	Q1ZcOmJjQi2VKeIk	19-499-258-2851	sleep carefully final deposits. furiously bold depo
1094	Customer#000001094	274877.4440	2544.49	BRAZIL	dls,MNN7EbF3GYrY3eRwSeOBZYd5o,cg	12-234-721-9871	structions among the furiously final pinto beans haggle fluffily 

# Q11
query IR
SELECT
    ps_partkey,
    sum(ps_supplycost * ps_availqty) AS value
FROM
    partsupp,
    supplier,
    nation
WHERE
    ps_suppkey = s_suppkey
    AND s_nationkey = n_nationkey
    AND n_name = 'GERMANY'
GROUP BY
    ps_partkey
HAVING
    sum(ps_supplycost * ps_availqty) > (
        SELECT
            sum(ps_supplycost * ps_availqty) * 0.0001000000
        FROM
            partsupp,
            supplier,
            nation
        WHERE
            ps_suppkey = s_suppkey
            AND s_nationkey = n_nationkey
            AND n_name = 'GERMANY')
ORDER BY
    value DESC
----
1376	13271249.89
788	9498648.06
1071	9388264.40
1768	9207199.75
1168	8881908.96
1084	8709494.16
1415	8471489.56
1338	8293841.12
124	8203209.30
1232	8111663.34
1643	7975862.75
1952	7936947.61
1944	7880018.60
1884	7513422.84
942	7511018.76
670	7299956.80
1532	7222347.20
1052	7158586.00
455	7064285.84
1176	7060670.89
143	7037648.64
1653	6949533.70
1140	6929464.08
1076	6877472.96
2000	6720009.38
348	6681307.34
810	6576640.95
943	6458641.70
720	6391330.27
1748	6341530.40
1241	6304944.66
1384	6279261.12
1784	6247863.25
984	6136927.00
445	6127784.28
1976	6079237.08
1609	6022720.80
1563	5978195.08
452	5838052.00
222	5737162.24
1629	5703117.12
1454	5694804.18
1082	5681981.25
691	5633589.72
1474	5614673.64
1900	5591905.36
262	5553285.32
1876	5517997.59
1027	5490916.00
1833	5451495.00
513	5374426.22
752	5358919.70
1367	5352773.25
543	5189101.68
1144	5174388.56
403	5126118.15
1406	5121886.44
320	5072099.76
1940	5069178.40
1503	5050895.50
1437	5039590.60
743	5039271.42
82	4995939.00
916	4994730.10
732	4932809.82
356	4879860.09
1592	4831242.60
1043	4825921.31
132	4781984.14
1006	4733954.64
497	4711173.60
1008	4565588.85
1370	4563830.10
216	4561143.80
34	4501982.71
1908	4417931.80
982	4391495.46
1652	4358793.14
614	4356657.45
1552	4355541.70
359	4353566.87
1104	4347515.90
198	4315049.00
998	4167784.88
1543	4159568.16
1308	4153124.95
474	4123819.20
1394	4122729.33
271	4095180.96
908	4088856.20
1135	4045014.13
1632	4010794.90
1362	3982060.16
158	3941881.65
1852	3923035.02
1556	3896709.54
584	3843848.30
885	3826021.16
376	3781201.96
712	3749696.80
2	3743241.43
676	3735715.20
1832	3709008.60
1955	3702794.70
68	3690702.41
1435	3659114.10
1443	3656762.84
1278	3653100.66
1920	3647892.54
423	3602031.80
818	3589047.60
779	3559597.53
485	3558511.44
552	3555470.10
1269	3510427.65
1602	3492117.70
426	3486888.02
1452	3480825.60
756	3469373.70
832	3447746.46
1493	3446867.40
1650	3417752.58
205	3403046.25
93	3361425.89
76	3342081.82
1759	3303050.40
886	3302180.70
1544	3288573.16
1932	3270900.40
489	3253368.30
594	3177408.57
184	3177162.05
950	3165213.01
1124	3143279.36
106	3099021.98
1964	3016553.10
384	2964262.77
974	2959497.10
964	2951329.45
1984	2907345.36
200	2895688.32
683	2829476.95
1564	2816506.56
546	2788059.64
502	2780828.64
396	2778421.39
203	2761439.88
866	2753031.20
1743	2743889.49
1041	2738083.92
1432	2713412.16
43	2587359.58
941	2587091.52
1890	2558739.69
1866	2545838.40
747	2511745.32
776	2506489.89
554	2505417.25
1210	2490820.92
1239	2405206.30
443	2382150.05
1661	2370574.16
1079	2363505.11
1329	2305870.42
1691	2261159.92
1247	2239553.28
1752	2230055.76
150	2217043.59
1814	2213635.20
289	2187160.45
1400	2139845.10
1898	2130114.96
1809	2122758.72
884	2107479.56
1038	2096868.97
1318	2051302.44
524	2035262.22
414	2029692.45
298	2026981.74
1996	2020953.54
1742	2019190.80
1620	2010112.00
877	1956429.18
1332	1919029.56
1536	1859318.15
1116	1852588.28
447	1817951.32
1676	1802306.08
1911	1779646.44
1459	1767602.30
576	1761838.75
1273	1754235.01
583	1725649.92
532	1682311.48
1732	1652831.20
1572	1650953.52
1889	1638443.72
476	1631154.06
1221	1629883.46
1792	1606346.10
243	1603235.16
328	1569826.72
1999	1553706.00
1611	1529857.01
643	1512838.80
1276	1467567.28
1823	1462293.00
1	1456050.96
27	1425832.40
632	1408087.26
1184	1406101.78
252	1379186.35
392	1354813.18
1215	1344383.20
26	1337002.89
84	1334146.71
784	1327297.01
1803	1327045.06
352	1326102.34
165	1289075.76
176	1285866.20
1314	1244173.26
1701	1239095.44
844	1225696.05
1988	1216798.33
1847	1202012.13
1706	1184125.10
744	1182820.80
230	1165932.30
418	1078321.44
174	1060584.80
1073	1028449.89
1726	1018673.04
1206	1002319.49
1343	998105.76
952	997684.24
484	991530.93
932	980620.68
843	978862.92
1841	962131.86
494	957575.34
659	954291.05
251	939764.70
1413	936951.94
572	906111.99
32	894484.09
9	893905.92
1498	890887.85
1790	878923.64
1670	854046.43
876	842245.67
1758	841275.42
930	832963.68
284	826642.60
1710	811504.38
1047	791214.45
653	788974.21
315	770526.05
1734	763569.40
1017	715302.72
1305	713351.43
77	688865.82
1512	682434.15
276	680239.04
1284	671225.94
1356	665716.83
800	663414.65
117	639650.88
652	635629.28
57	630987.44
1426	628241.25
1196	622427.16
51	622249.54
1846	621068.80
601	615942.60
645	607985.84
684	571490.70
465	570337.40
562	567651.24
387	556634.76
1152	555989.28
1202	553818.18
1112	552658.68
304	535868.16
368	526995.84
1800	526711.11
1148	515702.16
225	513587.57
324	500954.58
586	499475.58
1576	494401.05
1484	462396.27
126	461263.74
1132	455492.24
622	449685.60
1160	448183.06
1352	439967.04
18	426442.08
7	414558.20
833	398540.87
1694	376443.98
650	370900.99
1504	370815.90
432	370528.52
612	367894.50
542	367653.66
456	360911.32
52	358792.36
1346	350637.43
59	342221.48
1107	341805.20
1171	334938.04
1062	326445.90
592	313081.75
1750	312229.33
1843	309456.95
180	308539.84
899	301989.50
1180	293452.50
522	291601.75
249	282520.32
1584	278559.38
1404	276057.90
1265	271079.76
154	269641.42
1295	265566.56
1523	263158.90
1635	254834.56
1776	234181.20
1097	234113.55
1258	233500.61
621	233431.30
152	229781.60
278	216372.84
232	211879.92
1684	201386.22
1243	199587.54
976	197432.10
819	191475.90
1943	191247.76
853	189232.64
400	188941.20
639	186533.28
851	184103.16
909	175099.00
257	169033.44
1445	164888.68
1855	164614.81
1252	158680.90
1014	156465.82
1717	148325.75
1032	146408.40
780	136296.26
918	135268.32
690	133826.88
711	113268.84
332	112181.30
1596	110565.00
295	97604.25

# Q12
query TII
SELECT
    l_shipmode,
    sum(
        CASE WHEN o_orderpriority = '1-URGENT'
            OR o_orderpriority = '2-HIGH' THEN
            1
        ELSE
            0
        END) AS high_line_count,
    sum(
        CASE WHEN o_orderpriority <> '1-URGENT'
            AND o_orderpriority <> '2-HIGH' THEN
            1
        ELSE
            0
        END) AS low_line_count
FROM
    orders,
    lineitem
WHERE
    o_orderkey = l_orderkey
    AND l_shipmode IN ('MAIL', 'SHIP')
    AND l_commitdate < l_receiptdate
    AND l_shipdate < l_commitdate
    AND l_receiptdate >= CAST('1994-01-01' AS date)
    AND l_receiptdate < CAST('1995-01-01' AS date)
GROUP BY
    l_shipmode
ORDER BY
    l_shipmode
----
MAIL	64	86
SHIP	61	96

# Q13
query II
SELECT
    c_count,
    count(*) AS custdist
FROM (
    SELECT
        c_custkey,
        count(o_orderkey)
    FROM
        customer
    LEFT OUTER JOIN orders ON c_custkey = o_custkey
    AND o_comment NOT LIKE '%special%requests%'
GROUP BY
    c_custkey) AS c_orders (c_custkey,
        c_count)
GROUP BY
    c_count
ORDER BY
    custdist DESC,
    c_count DESC
----
0	500
10	69
9	66
11	63
12	60
8	60
14	56
13	55
21	48
20	45
7	45
18	43
19	42
17	42
16	42
15	41
22	37
24	30
6	30
23	26
25	20
5	18
26	17
27	13
29	7
28	6
4	6
31	4
3	3
32	2
30	2
2	2

# Q14
query R
SELECT
    100.00 * sum(
        CASE WHEN p_type LIKE 'PROMO%' THEN
            l_extendedprice * (1 - l_discount)
        ELSE
            0
        END) / sum(l_extendedprice * (1 - l_discount)) AS promo_revenue
FROM
    lineitem,
    part
WHERE
    l_partkey = p_partkey
    AND l_shipdate >= date '1995-09-01'
    AND l_shipdate < CAST('1995-10-01' AS date)
----
15.48654581228407

# Q15
query ITTTR
WITH revenue AS (
    SELECT
        l_suppkey AS supplier_no,
        sum(l_extendedprice * (1 - l_discount)) AS total_revenue
    FROM
        lineitem
    WHERE
        l_shipdate >= CAST('1996-01-01' AS date)
      AND l_shipdate < CAST('1996-04-01' AS date)
    GROUP BY
        supplier_no
)
SELECT
    s_suppkey,
    s_name,
    s_address,
    s_phone,
    total_revenue
FROM
    supplier,
    revenue
WHERE
    s_suppkey = supplier_no
    AND total_revenue = (
        SELECT
            max(total_revenue)
        FROM revenue)
ORDER BY
    s_suppkey
----
21	Supplier#000000021	TZoQwNFFO i,baXpbpin02,hvuhE,GRVIKm 	12-253-590-5816	1161099.4636

# Q16
query TTII
SELECT
    p_brand,
    p_type,
    p_size,
    count(DISTINCT ps_suppkey) AS supplier_cnt
FROM
    partsupp,
    part
WHERE
    p_partkey = ps_partkey
    AND p_brand <> 'Brand#45'
    AND p_type NOT LIKE 'MEDIUM POLISHED%'
    AND p_size IN (49, 14, 23, 45, 19, 3, 36, 9)
    AND ps_suppkey NOT IN (
        SELECT
            s_suppkey
        FROM
            supplier
        WHERE
            s_comment LIKE '%Customer%Complaints%')
GROUP BY
    p_brand,
    p_type,
    p_size
ORDER BY
    supplier_cnt DESC,
    p_brand,
    p_type,
    p_size
----
Brand#14	PROMO BRUSHED STEEL	9	8
Brand#35	SMALL POLISHED COPPER	14	8
Brand#22	LARGE BURNISHED TIN	36	6
Brand#11	ECONOMY BURNISHED NICKEL	49	4
Brand#11	LARGE PLATED TIN	23	4
Brand#11	MEDIUM ANODIZED BRASS	45	4
Brand#11	MEDIUM BRUSHED BRASS	45	4
Brand#11	PROMO ANODIZED BRASS	3	4
Brand#11	PROMO ANODIZED BRASS	49	4
Brand#11	PROMO ANODIZED TIN	45	4
Brand#11	PROMO BURNISHED BRASS	36	4
Brand#11	SMALL ANODIZED TIN	45	4
Brand#11	SMALL PLATED COPPER	45	4
Brand#11	STANDARD POLISHED NICKEL	45	4
Brand#11	STANDARD POLISHED TIN	45	4
Brand#12	ECONOMY BURNISHED COPPER	45	4
Brand#12	LARGE ANODIZED TIN	45	4
Brand#12	LARGE BURNISHED BRASS	19	4
Brand#12	LARGE PLATED STEEL	36	4
Brand#12	MEDIUM PLATED BRASS	23	4
Brand#12	PROMO BRUSHED COPPER	14	4
Brand#12	PROMO BURNISHED BRASS	49	4
Brand#12	SMALL ANODIZED COPPER	23	4
Brand#12	STANDARD ANODIZED BRASS	3	4
Brand#12	STANDARD BURNISHED TIN	23	4
Brand#12	STANDARD PLATED STEEL	36	4
Brand#13	ECONOMY PLATED STEEL	23	4
Brand#13	ECONOMY POLISHED BRASS	9	4
Brand#13	ECONOMY POLISHED COPPER	9	4
Brand#13	LARGE ANODIZED TIN	19	4
Brand#13	LARGE BURNISHED TIN	49	4
Brand#13	LARGE POLISHED BRASS	3	4
Brand#13	MEDIUM ANODIZED STEEL	36	4
Brand#13	MEDIUM PLATED COPPER	19	4
Brand#13	PROMO BRUSHED COPPER	49	4
Brand#13	PROMO PLATED TIN	19	4
Brand#13	SMALL BRUSHED NICKEL	19	4
Brand#13	SMALL BURNISHED BRASS	45	4
Brand#14	ECONOMY ANODIZED STEEL	19	4
Brand#14	ECONOMY BURNISHED TIN	23	4
Brand#14	ECONOMY PLATED STEEL	45	4
Brand#14	ECONOMY PLATED TIN	9	4
Brand#14	LARGE ANODIZED NICKEL	9	4
Brand#14	LARGE BRUSHED NICKEL	45	4
Brand#14	SMALL ANODIZED NICKEL	45	4
Brand#14	SMALL BURNISHED COPPER	14	4
Brand#14	SMALL BURNISHED TIN	23	4
Brand#15	ECONOMY ANODIZED STEEL	36	4
Brand#15	ECONOMY BRUSHED BRASS	36	4
Brand#15	ECONOMY BURNISHED BRASS	14	4
Brand#15	ECONOMY PLATED STEEL	45	4
Brand#15	LARGE ANODIZED BRASS	45	4
Brand#15	LARGE ANODIZED COPPER	3	4
Brand#15	MEDIUM ANODIZED COPPER	9	4
Brand#15	MEDIUM PLATED TIN	9	4
Brand#15	PROMO POLISHED TIN	49	4
Brand#15	SMALL POLISHED STEEL	19	4
Brand#15	STANDARD BURNISHED STEEL	45	4
Brand#15	STANDARD PLATED NICKEL	19	4
Brand#15	STANDARD PLATED TIN	3	4
Brand#21	ECONOMY ANODIZED STEEL	19	4
Brand#21	ECONOMY BRUSHED TIN	49	4
Brand#21	LARGE BURNISHED COPPER	19	4
Brand#21	MEDIUM ANODIZED TIN	9	4
Brand#21	MEDIUM BURNISHED STEEL	23	4
Brand#21	PROMO BRUSHED STEEL	23	4
Brand#21	PROMO BURNISHED COPPER	19	4
Brand#21	STANDARD PLATED BRASS	49	4
Brand#21	STANDARD POLISHED TIN	36	4
Brand#22	ECONOMY BURNISHED NICKEL	19	4
Brand#22	LARGE ANODIZED STEEL	3	4
Brand#22	LARGE BURNISHED STEEL	23	4
Brand#22	LARGE BURNISHED STEEL	45	4
Brand#22	LARGE BURNISHED TIN	45	4
Brand#22	LARGE POLISHED NICKEL	19	4
Brand#22	MEDIUM ANODIZED TIN	9	4
Brand#22	MEDIUM BRUSHED BRASS	14	4
Brand#22	MEDIUM BRUSHED COPPER	3	4
Brand#22	MEDIUM BRUSHED COPPER	45	4
Brand#22	MEDIUM BURNISHED TIN	19	4
Brand#22	MEDIUM BURNISHED TIN	23	4
Brand#22	MEDIUM PLATED BRASS	49	4
Brand#22	PROMO BRUSHED BRASS	9	4
Brand#22	PROMO BRUSHED STEEL	36	4
Brand#22	SMALL BRUSHED NICKEL	3	4
Brand#22	SMALL BURNISHED STEEL	23	4
Brand#22	STANDARD PLATED NICKEL	3	4
Brand#22	STANDARD PLATED TIN	19	4
Brand#23	ECONOMY BRUSHED COPPER	9	4
Brand#23	LARGE ANODIZED COPPER	14	4
Brand#23	LARGE PLATED BRASS	49	4
Brand#23	MEDIUM BRUSHED NICKEL	3	4
Brand#23	PROMO ANODIZED COPPER	19	4
Brand#23	PROMO BURNISHED COPPER	14	4
Brand#23	PROMO POLISHED BRASS	14	4
Brand#23	SMALL BRUSHED BRASS	49	4
Brand#23	SMALL BRUSHED COPPER	45	4
Brand#23	SMALL BURNISHED COPPER	49	4
Brand#23	SMALL PLATED BRASS	36	4
Brand#23	SMALL POLISHED BRASS	9	4
Brand#23	STANDARD BRUSHED TIN	3	4
Brand#23	STANDARD PLATED BRASS	9	4
Brand#23	STANDARD PLATED STEEL	36	4
Brand#23	STANDARD PLATED TIN	19	4
Brand#24	ECONOMY BRUSHED BRASS	36	4
Brand#24	ECONOMY PLATED COPPER	36	4
Brand#24	LARGE PLATED NICKEL	36	4
Brand#24	MEDIUM PLATED STEEL	19	4
Brand#24	PROMO POLISHED BRASS	14	4
Brand#24	SMALL ANODIZED COPPER	3	4
Brand#24	STANDARD BRUSHED BRASS	14	4
Brand#24	STANDARD BRUSHED STEEL	14	4
Brand#24	STANDARD POLISHED NICKEL	14	4
Brand#25	ECONOMY BURNISHED TIN	19	4
Brand#25	ECONOMY PLATED NICKEL	23	4
Brand#25	LARGE ANODIZED NICKEL	23	4
Brand#25	LARGE BRUSHED NICKEL	19	4
Brand#25	LARGE BURNISHED TIN	49	4
Brand#25	MEDIUM BURNISHED NICKEL	49	4
Brand#25	MEDIUM PLATED BRASS	45	4
Brand#25	PROMO ANODIZED TIN	3	4
Brand#25	PROMO BURNISHED COPPER	45	4
Brand#25	PROMO PLATED NICKEL	3	4
Brand#25	SMALL BURNISHED COPPER	3	4
Brand#25	SMALL PLATED TIN	36	4
Brand#25	STANDARD ANODIZED TIN	9	4
Brand#25	STANDARD PLATED NICKEL	36	4
Brand#31	ECONOMY BURNISHED COPPER	36	4
Brand#31	ECONOMY PLATED STEEL	23	4
Brand#31	LARGE PLATED NICKEL	14	4
Brand#31	MEDIUM BURNISHED COPPER	3	4
Brand#31	MEDIUM PLATED TIN	36	4
Brand#31	PROMO ANODIZED NICKEL	9	4
Brand#31	PROMO POLISHED TIN	23	4
Brand#31	SMALL ANODIZED COPPER	3	4
Brand#31	SMALL ANODIZED COPPER	45	4
Brand#31	SMALL BRUSHED NICKEL	23	4
Brand#31	SMALL PLATED COPPER	36	4
Brand#32	ECONOMY ANODIZED COPPER	36	4
Brand#32	ECONOMY PLATED COPPER	9	4
Brand#32	LARGE ANODIZED STEEL	14	4
Brand#32	MEDIUM ANODIZED STEEL	49	4
Brand#32	MEDIUM BURNISHED BRASS	9	4
Brand#32	MEDIUM BURNISHED BRASS	49	4
Brand#32	PROMO BRUSHED STEEL	23	4
Brand#32	PROMO BURNISHED TIN	45	4
Brand#32	SMALL ANODIZED TIN	9	4
Brand#32	SMALL BRUSHED COPPER	3	4
Brand#32	SMALL PLATED COPPER	45	4
Brand#32	SMALL POLISHED STEEL	36	4
Brand#32	SMALL POLISHED TIN	45	4
Brand#32	STANDARD PLATED STEEL	36	4
Brand#33	ECONOMY BURNISHED COPPER	14	4
Brand#33	ECONOMY POLISHED BRASS	14	4
Brand#33	LARGE BRUSHED TIN	36	4
Brand#33	MEDIUM ANODIZED BRASS	3	4
Brand#33	MEDIUM BURNISHED COPPER	14	4
Brand#33	MEDIUM PLATED STEEL	49	4
Brand#33	PROMO PLATED STEEL	49	4
Brand#33	PROMO PLATED TIN	49	4
Brand#33	PROMO POLISHED STEEL	9	4
Brand#33	SMALL ANODIZED COPPER	23	4
Brand#33	SMALL BRUSHED STEEL	3	4
Brand#33	SMALL BURNISHED NICKEL	3	4
Brand#33	STANDARD PLATED NICKEL	36	4
Brand#34	ECONOMY ANODIZED TIN	49	4
Brand#34	LARGE ANODIZED BRASS	23	4
Brand#34	LARGE BRUSHED COPPER	23	4
Brand#34	LARGE BURNISHED TIN	49	4
Brand#34	LARGE PLATED BRASS	45	4
Brand#34	MEDIUM BRUSHED COPPER	9	4
Brand#34	MEDIUM BRUSHED TIN	14	4
Brand#34	MEDIUM BURNISHED NICKEL	3	4
Brand#34	SMALL ANODIZED STEEL	23	4
Brand#34	SMALL BRUSHED TIN	9	4
Brand#34	SMALL PLATED BRASS	14	4
Brand#34	STANDARD ANODIZED NICKEL	36	4
Brand#34	STANDARD BRUSHED TIN	19	4
Brand#34	STANDARD BURNISHED TIN	23	4
Brand#34	STANDARD PLATED NICKEL	36	4
Brand#35	PROMO BURNISHED BRASS	3	4
Brand#35	PROMO BURNISHED STEEL	14	4
Brand#35	PROMO PLATED BRASS	19	4
Brand#35	STANDARD ANODIZED NICKEL	14	4
Brand#35	STANDARD ANODIZED STEEL	23	4
Brand#35	STANDARD BRUSHED BRASS	3	4
Brand#35	STANDARD BRUSHED NICKEL	49	4
Brand#35	STANDARD PLATED STEEL	14	4
Brand#41	MEDIUM ANODIZED NICKEL	9	4
Brand#41	MEDIUM BRUSHED TIN	9	4
Brand#41	MEDIUM PLATED STEEL	19	4
Brand#41	PROMO ANODIZED NICKEL	9	4
Brand#41	SMALL ANODIZED STEEL	45	4
Brand#41	SMALL POLISHED COPPER	14	4
Brand#41	STANDARD ANODIZED NICKEL	9	4
Brand#41	STANDARD ANODIZED TIN	36	4
Brand#41	STANDARD ANODIZED TIN	49	4
Brand#41	STANDARD BRUSHED TIN	45	4
Brand#41	STANDARD PLATED TIN	49	4
Brand#42	ECONOMY BRUSHED COPPER	14	4
Brand#42	LARGE ANODIZED NICKEL	49	4
Brand#42	MEDIUM PLATED TIN	45	4
Brand#42	PROMO BRUSHED STEEL	19	4
Brand#42	PROMO BURNISHED TIN	49	4
Brand#42	PROMO PLATED STEEL	19	4
Brand#42	PROMO PLATED STEEL	45	4
Brand#42	STANDARD BURNISHED NICKEL	49	4
Brand#42	STANDARD PLATED COPPER	19	4
Brand#43	ECONOMY ANODIZED COPPER	19	4
Brand#43	ECONOMY ANODIZED NICKEL	49	4
Brand#43	ECONOMY PLATED TIN	19	4
Brand#43	ECONOMY POLISHED TIN	45	4
Brand#43	LARGE BURNISHED COPPER	3	4
Brand#43	LARGE POLISHED TIN	45	4
Brand#43	MEDIUM ANODIZED BRASS	14	4
Brand#43	MEDIUM ANODIZED COPPER	36	4
Brand#43	MEDIUM ANODIZED COPPER	49	4
Brand#43	MEDIUM BURNISHED TIN	23	4
Brand#43	PROMO BRUSHED BRASS	36	4
Brand#43	PROMO BURNISHED STEEL	3	4
Brand#43	PROMO POLISHED BRASS	19	4
Brand#43	SMALL BRUSHED NICKEL	9	4
Brand#43	SMALL POLISHED STEEL	19	4
Brand#43	STANDARD ANODIZED BRASS	3	4
Brand#43	STANDARD PLATED TIN	14	4
Brand#44	ECONOMY ANODIZED NICKEL	36	4
Brand#44	ECONOMY POLISHED NICKEL	23	4
Brand#44	LARGE ANODIZED BRASS	19	4
Brand#44	LARGE BRUSHED TIN	3	4
Brand#44	MEDIUM BRUSHED STEEL	19	4
Brand#44	MEDIUM BURNISHED COPPER	45	4
Brand#44	MEDIUM BURNISHED NICKEL	23	4
Brand#44	MEDIUM PLATED COPPER	14	4
Brand#44	SMALL ANODIZED COPPER	23	4
Brand#44	SMALL ANODIZED TIN	45	4
Brand#44	SMALL PLATED COPPER	19	4
Brand#44	STANDARD ANODIZED COPPER	3	4
Brand#44	STANDARD ANODIZED NICKEL	36	4
Brand#51	ECONOMY ANODIZED STEEL	9	4
Brand#51	ECONOMY PLATED NICKEL	49	4
Brand#51	ECONOMY POLISHED COPPER	9	4
Brand#51	ECONOMY POLISHED STEEL	49	4
Brand#51	LARGE BURNISHED BRASS	19	4
Brand#51	LARGE POLISHED STEEL	19	4
Brand#51	MEDIUM ANODIZED TIN	14	4
Brand#51	PROMO BRUSHED BRASS	23	4
Brand#51	PROMO POLISHED STEEL	49	4
Brand#51	SMALL BRUSHED TIN	36	4
Brand#51	SMALL POLISHED STEEL	49	4
Brand#51	STANDARD BRUSHED COPPER	3	4
Brand#51	STANDARD BRUSHED NICKEL	19	4
Brand#51	STANDARD BURNISHED COPPER	19	4
Brand#52	ECONOMY ANODIZED BRASS	14	4
Brand#52	ECONOMY ANODIZED COPPER	36	4
Brand#52	ECONOMY BURNISHED NICKEL	19	4
Brand#52	ECONOMY BURNISHED STEEL	36	4
Brand#52	ECONOMY PLATED TIN	23	4
Brand#52	LARGE BRUSHED NICKEL	19	4
Brand#52	LARGE BURNISHED TIN	45	4
Brand#52	LARGE PLATED STEEL	9	4
Brand#52	LARGE PLATED TIN	9	4
Brand#52	LARGE POLISHED NICKEL	36	4
Brand#52	MEDIUM BURNISHED TIN	45	4
Brand#52	SMALL ANODIZED NICKEL	36	4
Brand#52	SMALL ANODIZED STEEL	9	4
Brand#52	SMALL BRUSHED STEEL	23	4
Brand#52	SMALL BURNISHED NICKEL	14	4
Brand#52	STANDARD POLISHED STEEL	19	4
Brand#53	LARGE BURNISHED NICKEL	23	4
Brand#53	LARGE PLATED BRASS	9	4
Brand#53	LARGE PLATED STEEL	49	4
Brand#53	MEDIUM BRUSHED COPPER	3	4
Brand#53	MEDIUM BRUSHED STEEL	45	4
Brand#53	SMALL BRUSHED BRASS	36	4
Brand#53	STANDARD PLATED STEEL	45	4
Brand#54	ECONOMY ANODIZED BRASS	9	4
Brand#54	ECONOMY BRUSHED TIN	19	4
Brand#54	ECONOMY POLISHED BRASS	49	4
Brand#54	LARGE ANODIZED BRASS	49	4
Brand#54	LARGE BURNISHED BRASS	49	4
Brand#54	LARGE BURNISHED TIN	14	4
Brand#54	LARGE POLISHED BRASS	19	4
Brand#54	MEDIUM BURNISHED STEEL	3	4
Brand#54	SMALL BURNISHED STEEL	19	4
Brand#54	SMALL PLATED BRASS	23	4
Brand#54	SMALL PLATED TIN	14	4
Brand#55	LARGE BRUSHED NICKEL	9	4
Brand#55	LARGE PLATED TIN	9	4
Brand#55	LARGE POLISHED STEEL	36	4
Brand#55	MEDIUM BRUSHED TIN	45	4
Brand#55	PROMO BRUSHED STEEL	36	4
Brand#55	PROMO BURNISHED STEEL	14	4
Brand#55	SMALL PLATED COPPER	45	4
Brand#55	STANDARD ANODIZED BRASS	36	4
Brand#55	STANDARD BRUSHED COPPER	3	4
Brand#55	STANDARD BRUSHED STEEL	19	4

# Q17
query R
SELECT
    sum(l_extendedprice) / 7.0 AS avg_yearly
FROM
    lineitem,
    part
WHERE
    p_partkey = l_partkey
    AND p_brand = 'Brand#23'
    AND p_container = 'MED BOX'
    AND l_quantity < (
        SELECT
            0.2 * avg(l_quantity)
        FROM
            lineitem
        WHERE
            l_partkey = p_partkey)
----
NULL

# Q18
query TIITRR
SELECT
    c_name,
    c_custkey,
    o_orderkey,
    o_orderdate,
    o_totalprice,
    sum(l_quantity)
FROM
    customer,
    orders,
    lineitem
WHERE
    o_orderkey IN (
        SELECT
            l_orderkey
        FROM
            lineitem
        GROUP BY
            l_orderkey
        HAVING
            sum(l_quantity) > 300)
    AND c_custkey = o_custkey
    AND o_orderkey = l_orderkey
GROUP BY
    c_name,
    c_custkey,
    o_orderkey,
    o_orderdate,
    o_totalprice
ORDER BY
    o_totalprice DESC,
    o_orderdate
LIMIT 100
----
Customer#000000667	667	29158	1995-10-21	439687.23	305.00
Customer#000000178	178	6882	1997-04-09	422359.65	303.00

# Q19
query R
SELECT
    sum(l_extendedprice * (1 - l_discount)) AS revenue
FROM
    lineitem,
    part
WHERE (p_partkey = l_partkey
    AND p_brand = 'Brand#12'
    AND p_container IN ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG')
    AND l_quantity >= 1
    AND l_quantity <= 1 + 10
    AND p_size BETWEEN 1 AND 5
    AND l_shipmode IN ('AIR', 'AIR REG')
    AND l_shipinstruct = 'DELIVER IN PERSON')
    OR (p_partkey = l_partkey
        AND p_brand = 'Brand#23'
        AND p_container IN ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK')
        AND l_quantity >= 10
        AND l_quantity <= 10 + 10
        AND p_size BETWEEN 1 AND 10
        AND l_shipmode IN ('AIR', 'AIR REG')
        AND l_shipinstruct = 'DELIVER IN PERSON')
    OR (p_partkey = l_partkey
        AND p_brand = 'Brand#34'
        AND p_container IN ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG')
        AND l_quantity >= 20
        AND l_quantity <= 20 + 10
        AND p_size BETWEEN 1 AND 15
        AND l_shipmode IN ('AIR', 'AIR REG')
        AND l_shipinstruct = 'DELIVER IN PERSON')
----
22923.0280

# Q20
query TT
SELECT
    s_name,
    s_address
FROM
    supplier,
    nation
WHERE
    s_suppkey IN (
        SELECT
            ps_suppkey
        FROM
            partsupp
        WHERE
            ps_partkey IN (
                SELECT
                    p_partkey
                FROM
                    part
                WHERE
                    p_name LIKE 'forest%')
                AND ps_availqty > (
                    SELECT
                        0.5 * sum(l_quantity)
                    FROM
                        lineitem
                    WHERE
                        l_partkey = ps_partkey
                        AND l_suppkey = ps_suppkey
                        AND l_shipdate >= CAST('1994-01-01' AS date)
                        AND l_shipdate < CAST('1995-01-01' AS date)))
            AND s_nationkey = n_nationkey
            AND n_name = 'CANADA'
        ORDER BY
            s_name
----
Supplier#000000013	kgTZjbt4CAa4c3SlirlBLqIL41YbCj

# Q21
query TI
SELECT
    s_name,
    count(*) AS numwait
FROM
    supplier,
    lineitem l1,
    orders,
    nation
WHERE
    s_suppkey = l1.l_suppkey
    AND o_orderkey = l1.l_orderkey
    AND o_orderstatus = 'F'
    AND l1.l_receiptdate > l1.l_commitdate
    AND EXISTS (
        SELECT
            *
        FROM
            lineitem l2
        WHERE
            l2.l_orderkey = l1.l_orderkey
            AND l2.l_suppkey <> l1.l_suppkey)
    AND NOT EXISTS (
        SELECT
            *
        FROM
            lineitem l3
        WHERE
            l3.l_orderkey = l1.l_orderkey
            AND l3.l_suppkey <> l1.l_suppkey
            AND l3.l_receiptdate > l3.l_commitdate)
    AND s_nationkey = n_nationkey
    AND n_name = 'SAUDI ARABIA'
GROUP BY
    s_name
ORDER BY
    numwait DESC,
    s_name
LIMIT 100
----
Supplier#000000074	9

# Q22
query TIR
SELECT
    cntrycode,
    count(*) AS numcust,
    sum(c_acctbal) AS totacctbal
FROM (
    SELECT
        substring(c_phone FROM 1 FOR 2) AS cntrycode,
        c_acctbal
    FROM
        customer
    WHERE
        substring(c_phone FROM 1 FOR 2) IN ('13', '31', '23', '29', '30', '18', '17')
        AND c_acctbal > (
            SELECT
                avg(c_acctbal)
            FROM
                customer
            WHERE
                c_acctbal > 0.00
                AND substring(c_phone FROM 1 FOR 2) IN ('13', '31', '23', '29', '30', '18', '17'))
            AND NOT EXISTS (
                SELECT
                    *
                FROM
                    orders
                WHERE
                    o_custkey = c_custkey)) AS custsale
GROUP BY
    cntrycode
ORDER BY
    cntrycode
----
13	10	75359.29
17	8	62288.98
18	14	111072.45
23	5	40458.86
29	11	88722.85
30	17	122189.33
31	8	66313.16

